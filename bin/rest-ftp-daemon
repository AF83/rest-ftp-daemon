#!/usr/bin/env ruby

# Libs and init
require "thin"

# Initialize some local constants
APP_ROOT = File.dirname(__FILE__) + '/../'
rackup_file = File.expand_path "#{APP_ROOT}/config.ru"

# Include config file
require File.expand_path "#{APP_ROOT}/lib/rest-ftp-daemon/config.rb"

# Prepare thin
argv = ARGV
argv << ["-R", rackup_file] unless ARGV.include?("-R")
argv << ["-l", "/tmp/thin.log"] unless ARGV.include?("-l")
argv << ["--daemonize"] unless ARGV.include?("--daemonize")
argv << ["-e", "production"] unless ARGV.include?("-e")
argv << ["-p", (RestFtpDaemon::PORT).to_s] unless ARGV.include?("-p")
#argv << ["--stats", "/stats"] unless ARGV.include?("--stats")

# Start Thin with this rackup configuration
puts "#{RestFtpDaemon::NAME}: using [#{argv.join (' ')}]"
begin
  Thin::Runner.new(argv.flatten).run!
rescue Thin::PidFileNotFound
  puts "#{RestFtpDaemon::NAME}: not running (Thin::PidFileNotFound)"
end


