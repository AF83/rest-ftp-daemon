!!! 5
%html{:lang => "en"}
  %head
    %meta{:charset => "utf-8"}/
    %link{ href:"/css/bootstrap.css" , rel: "stylesheet"}
    %link{ href:"/css/main.css" , rel: "stylesheet"}

    %title="#{Settings['host']} [#{Settings.namespace}] #{APP_NAME}"

    :css

      h2 {
        font-size: 1.5em;
        margin-top: 2em;
      }

      #header {
        padding: 20px auto;
        border-bottom: 1px solid silver;
        background-color: #eee;
        }

      .progress {
        margin-bottom: 0;
        }

  %body

    .navbar.navbar-default.navbar-fixed
      .container

        .navbar-header
          %h1
            = APP_NAME
            %small
              = "v#{APP_VER}"
              = "[#{Settings.namespace}]"


    .container

      - trans = $queue.counter_get :transferred
      .btn-group.btn-group-sm
        .btn.btn-default.btn-success Processors
        .btn.btn-default= @info_procs

      .btn-group.btn-group-sm
        .btn.btn-default.btn-success IP
        .btn.btn-default= @info_ipaddr

      .btn-group.btn-group-sm
        .btn.btn-default.btn-success Host
        .btn.btn-default= Settings['host']

      .btn-group.btn-group-sm
        .btn.btn-default.btn-warning Load
        .btn.btn-default= @info_load.round(1)

      .btn-group.btn-group-sm
        .btn.btn-default.btn-warning CPU
        .btn.btn-default= "#{@info_norm} %"

      .btn-group.btn-group-sm
        .btn.btn-default.btn-warning Free
        .btn.btn-default= @info_memfree

      .btn-group.btn-group-sm
        .btn.btn-default.btn-info Transferred
        .btn.btn-default= Helpers.format_bytes(trans, "B")


      .row
        .col-md-10

          %h2
            Jobs &nbsp;

            .btn-group.btn-group-md
              - klass = @only.nil? ? "btn-info" : ""
              %a.btn.btn-default{href: "?only=", class: klass}
                ALL (#{@jobs_queued.size})
            .btn-group.btn-group-md
              - @counts.each do |status, count|
                - klass = (status == @only) ? "btn-info" : ""
                %a.btn.btn-default{href: "?only=#{status}", class: klass}
                  #{status} (#{count})

          %table.table.table-striped.table-hover.table-condensed
            %tr
              %th JID
              %th prio
              %th worker
              %th source
              %th target
              %th status
              %th error
              %th size
              %th progress
              %th.text-right bitrate

            - if @only.nil? && !@jobs_queued.empty?
              = render :dashboard_jobs, {jobs: @jobs_queued, counts: @counts}
              %tr
                %th{colspan: 10}

            = render :dashboard_jobs, {jobs: @jobs_popped, counts: @counts}


        .col-md-2
          = render :dashboard_workers, {}

      = render :dashboard_tokens, {tokens: Settings.endpoints || {}}

      %br
      %br
